<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Staff Panel - Smart QR Attendance</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; }
    .staff-container { max-width: 800px; margin: 0 auto; padding: 20px; }
    .card { background: #fff; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background-color: #007BFF; color: white; }
    td { background-color: #f9f9f9; }
  </style>
</head>
<body>
  <div class="staff-container">
    <header>
      <h2>Welcome, Staff</h2>
    </header>

    <section class="card">
      <h3>Add Student</h3>
      <form id="addStudentForm">
        <input type="text" id="studentName" placeholder="Student Name" required />
        <input type="text" id="registerNumber" placeholder="Register Number" required />
        <input type="password" id="studentPassword" placeholder="Password" required />
        <button type="submit">Add Student</button>
      </form>
    </section>

    <section class="card">
      <h3>Scan QR to Mark Attendance</h3>
      <button onclick="location.href='scan.html'">Start Scanning</button>
    </section>

    <section class="card">
      <h3>Attendance Table</h3>
      <div class="table-wrapper">
        <table>
          <thead>
            <tr id="tableHeader">
              <th>Student Name</th>
              <th>Register No</th>
              <!-- Date headers will be added here -->
            </tr>
          </thead>
          <tbody id="attendanceTable">
            <!-- Student rows will be added here -->
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    // Load data from localStorage
    let students = JSON.parse(localStorage.getItem("students") || "[]");
    let attendance = JSON.parse(localStorage.getItem("attendance") || "{}");

    // Save student
    document.getElementById("addStudentForm").addEventListener("submit", function (e) {
      e.preventDefault();
      let name = document.getElementById("studentName").value;
      let reg = document.getElementById("registerNumber").value;
      let pass = document.getElementById("studentPassword").value;

      students.push({ name, reg, pass });
      localStorage.setItem("students", JSON.stringify(students));

      // Add default empty attendance
      attendance[reg] = attendance[reg] || {};
      localStorage.setItem("attendance", JSON.stringify(attendance));

      this.reset();
      renderTable();
    });

    function getAllDates() {
      let allDates = new Set();
      Object.values(attendance).forEach(record => {
        Object.keys(record).forEach(date => allDates.add(date));
      });
      return Array.from(allDates);
    }

    function renderTable() {
      let tableBody = "";
      let dates = getAllDates();

      // Update header
      const headerRow = document.getElementById("tableHeader");
      headerRow.innerHTML = `<th>Student Name</th><th>Register No</th>`;
      dates.forEach(d => {
        headerRow.innerHTML += `<th>${d}</th>`;
      });

      // Update rows
      students.forEach(s => {
        let row = `<tr><td>${s.name}</td><td>${s.reg}</td>`;
        dates.forEach(d => {
          row += `<td>${attendance[s.reg]?.[d] || "‚ùå"}</td>`;
        });
        row += "</tr>";
        tableBody += row;
      });

      document.getElementById("attendanceTable").innerHTML = tableBody;
    }

    renderTable(); // Initial render
  </script>
</body>
</html>